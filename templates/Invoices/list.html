{% extends "base.html" %}

{% block link %}
<link rel="stylesheet" href="{{ url_for('static', filename='/css/table.css') }}" />
{% endblock %}

{% block title %}Invoices{% endblock %}

{% block main %}
<div class="container-fluid m-t70">
  <div class="row">
    <div class="col-md-12">
      <br />
      <form id="invoice-form" action="/dispatch/add" method="post">
        <div class="card">
          <div class="card-header">
            <button type="submit" class="btn btn-primary float-end mx-3">
              Delivery Nikalo
            </button>
            <button type="button" class="btn btn-primary float-end">
              <a href="/invoice/add" style="color: inherit; text-decoration: none">Add Invoice</a>
            </button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered mb-0 table-centered">
                <thead class="tHead">
                  <tr>
                    <th><input type="checkbox" id="select-all" /></th>
                    <th scope="col">Sr.</th>
                    <th scope="col">Date</th>
                    <th scope="col">Booker</th>
                    <th scope="col">DSR</th>
                    <th scope="col">Bill ID</th>
                    <th scope="col">Customer</th>
                    <th scope="col">Value</th>
                    <th scope="col">Revisions</th>
                    <th scope="col">Age</th>
                    <th scope="col">Delivery Status</th>
                    <th scope="col">Delivery Man</th>
                    <th class="text-center">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for user in data %}
                  <tr>
                    <td><input type="checkbox" name="{{ loop.index }}" class="select-item" value="{{ user['invoice_id'] }}" /></td>
                    <td>{{ loop.index }}</td>
                    <td>{{ user['created_at'] }}</td>
                    <td>{{ user['booker_name'] }}</td>
                    <td>{{ user['dsr'] }}</td>
                    <td>{{ user['invoice_id'] }}</td>
                    <td>{{ user['customer_name'] }}</td>
                    <td>{{ user['total'] }}</td>
                    <td>{{ user['revision'] }}</td>
                    
                    <td>{{ user['age'] }} days</td>
                    <td>{{ user['delivery_status'] }}</td>
                    <td>
                      {% if user['delivery_man'] %}{{ user['delivery_man'] }}{% else %}Un-Assigned{% endif %}
                    </td>
                    <td class="text-center">
                      <a href="/invoice/{{ user['invoice_id'] }}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-eye"></i>
                      </a>
                      <a href="/invoice/edit/{{ user['invoice_id'] }}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a href="/invoice/delete/{{ user['invoice_id'] }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('Are you sure you want to delete this invoice?');">
                        <i class="fas fa-trash"></i>
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </form>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          document.getElementById("select-all").addEventListener("click", function () {
            var isChecked = this.checked;
            document.querySelectorAll(".select-item").forEach(function (checkbox) {
              checkbox.checked = isChecked;
            });
          });
        });
      </script>
    </div>
  </div>
</div>
{% endblock %}
